/**:
  ros__parameters:
    ############ system configuration ############
    # Data logging
    log_to_file: true
    log_debug: false
    log_enabled: [
        ## ADD LOGGER IDS HERE
        # tactic
        # "tactic",
        # "tactic.pipeline",
        "tactic.module",
        # "pose_graph",
        # "tactic.module.live_mem_manager",
        # "tactic.module.graph_mem_manager",
        # pipeline specific
        # "lidar.pipeline",
        # "lidar.aeva_converter",
        # "lidar.preprocessing_doppler",
        # "lidar.odometry_icp",
        # "lidar.odometry_doppler",
        # "lidar.odometry_map_maintenance",
        # "lidar.vertex_test",
        # "lidar.localization_map_recall",
        # "lidar.localization_icp",
      ]
    
    aeriesII: true
    bo_path: "/home/asrl-katya/ASRL/doppler_odom/sensor_config/boreas"

    ############ tactic configuration ############
    tactic:
      enable_parallelization: false
      preprocessing_skippable: false
      odometry_mapping_skippable: false
      localization_skippable: false

      task_queue_num_threads: 1
      task_queue_size: -1

      chain:
        min_cusp_distance: 1.5
        angle_weight: 7.0
        search_depth: 5
        search_back_depth: 10
        distance_warning: 30.0

      save_odometry_result: true
      save_odometry_vel_result: false
      save_localization_result: true
      visualize: true

      # localization interval threshold
      use_loc_threshold: false
      loc_threshold: 1 # num frames

      rviz_loc_path_offset: [0., 0., 0.]

    ############ pipeline configuration ############
    pipeline:
      type: lidar

      preprocessing: [
          # preprocessing thread modules
          "conversion",
          "filtering",
        ]

      odometry: [
          # odometry and mapping thread modules
          "icp",
          # "doppler", 
          "mapping",
          "vertex_test",
          "memory",
        ]

      localization: [
          # localization thread modules
          "recall",
          "icp",
          "memory",
        ]

      # submap creation thresholds
      submap_translation_threshold: 10.0 # in meters
      submap_rotation_threshold: 30.0 # in degrees

    preprocessing:
      conversion:
        type: lidar.aeva_converter

        visualize: true

      filtering:
        # if using odometry_icp, change type below to `lidar.preprocessing`
        # if using odometry_doppler, change type below to `lidar.preprocessing_doppler`
        # type: lidar.preprocessing_doppler
        type: lidar.preprocessing
        num_threads: 10

        # lidar.preprocessing parameters
        crop_range: 150.0
        # 
        # vertical_angle_res: 0.0020943951 # vertical angle resolution in radians (0.12 deg w/ 30 vertical FOV) (0020943951)
        vertical_angle_res: 0.007561638984
        # vertical_angle_res: 0.00349066
        polar_r_scale: 2.0 # 1.0 # polar_r_scale x vertical_angle_res = nearest neighbor search radius for normal computation
        r_scale: 4.0 # scale down point range by this value after taking log, whatever works
        # h_scale: 0.5167 # scale down yaw(phi) by this value so that vertical resolution ~= horizontal resolution (0.062 deg / 0.12 deg = 0.5167)
        # h_scale: 2.0 # 4.0
        h_scale: 4.0
        #
        frame_voxel_size: 0.5 # grid subsampling voxel size
        filter_normal: true
        #
        num_sample1: 10000 # max number of sample after filtering based on planarity
        min_norm_score1: 0.95 # min planarity score
        #
        num_sample2: 10000 # max number of sample after filtering based on planarity
        min_norm_score2: 0.0 # 0.2 is when the incident angle 5/12 * pi
        min_normal_estimate_dist: 2.0 # minimum distance to estimate normal in meters
        max_normal_estimate_angle: 0.42 # must <1/2, this value will be timed by M_PI
        #
        cluster_num_sample: 10000 # maxnumber of sample after removing isolated points

        # lidar.preprocessing_doppler parameters
        # # aeriesI
        # azimuth_res: 0.00349066         # vertical angle resolution in radians
        # azimuth_start: -0.872665        # -50 deg in rad
        # azimuth_end: 0.872665
        # num_rows: 80                    # num of vertical scan lines  
        # num_cols: 501                   # 100 deg FOV, 0.2 deg resolution
        # min_dist: 20                    # meters
        # max_dist: 150                   # meters
        # const_gyro_bias: [-0.00424229788086775, -0.01544970808768110, 0.00284478234035327]
        # model_name: "mar8_boreas_lrvar_bp4-rim_vp3-imv-g_r5-150-e5_a0p1_aplat"

        # aeriesII
        azimuth_res: 0.00349066         # vertical angle resolution in radians
        azimuth_start: -1.0472          # -60 deg in rad
        azimuth_end: 1.0472
        # azimuth_start: -1.0              
        # azimuth_end: 1.094
        num_rows: 64                    # num of vertical scan lines
        num_cols: 601                   # 120 deg FOV, 0.2 deg resolution
        min_dist: 20                    # meters
        max_dist: 150                   # meters
        const_gyro_bias: [0.009447768, 0.010163047, 0.0062276833]
        # const_gyro_bias: [0.009018582, 0.0099393, 0.0062442548]
        model_name: "aeriesii"

        # common to I and II
        active_lidars: [true]                                                 # only one sensor
        active_gyros: [true]  
        root_path: "/home/asrl-katya/ASRL/doppler_odom/sensor_config/boreas"  # point this to where we find the trained sensor model
        downsample_steps: 2                                                   # after image projection 
        bias_input_feat: ["range", "intensity", "medianrv"]
        var_input_feat: ["intensity", "medianrv", "rv_var5"]
        bias_polyorder: 3 # UPDATE
        var_polyorder: 2 # UPDATE
        median_sensorid: 0                                                     # only one sensor

        visualize: true

    odometry:
      icp:
        type: lidar.odometry_icp

        # continuous time estimation
        use_trajectory_estimation: true
        traj_num_extra_states: 0
        traj_lock_prev_pose: true
        traj_lock_prev_vel: false
        # traj_qc_diag: [50.0, 50.0, 50.0, 5.0, 5.0, 5.0]
        traj_qc_diag: [1.0, 0.0001, 0.0001, 0.0001, 0.0001, 0.01] # good

        use_radial_velocity: false
        rv_cov: 1.0
        rv_loss_threshold: 1.0

        use_velocity_prior: false
        vp_cov: [1000.0, 0.001, 1000.0, 1000.0, 1000.0, 1000.0]

        # ICP parameters
        num_threads: 10
        first_num_steps: 3
        initial_max_iter: 6
        initial_max_pairing_dist: 3.0
        initial_max_planar_dist: 1.0
        refined_max_iter: 50
        refined_max_pairing_dist: 1.0
        refined_max_planar_dist: 0.3
        averaging_num_steps: 3
        # steam parameters
        verbose: false
        max_iterations: 1

        # threshold
        min_matched_ratio: 0.0

        visualize: true

      doppler:
        type: lidar.odometry_doppler
        # continuous time estimation
        use_trajectory_estimation: true
        traj_num_extra_states: 0
        traj_lock_prev_pose: false
        traj_lock_prev_vel: false
        traj_qc_diag: [1.0, 0.001, 0.001, 0.001, 0.001, 1.0]


        # doppler odom parameters
        num_threads: 10
        num_sensors: 1
        ransac_seed: 0
        ransac_gyro: false
        ransac_max_iter: 40
        ransac_thres: 0.4
        ransac_min_range: 5.0
        integration_steps: 100
        zero_vel_tol: 0.03

        min_dist_lidar_center: 5.0 
        max_dist_lidar_center: 150.0 

        # P0inv: [1e4, 1e4, 1e4, 1e6, 1e6, 1e6]

        # # aeva_boreas
        # Qkinv: [124.097194, 852.430330017, 448.704299478, 1128.19639192, 1230.02908934, 11316.9459369]
        # #Qzinv: [0.0, 0.0, 0.0, 14274.3037743, 11121.0286591, 0.0]
        # Qzinv: [0.0, 100.0, 100.0, 14274.3037743, 11121.0286591, 0.0]

        P0inv: [1e4, 1e4, 1e4, 1e6, 1e6, 1e6]
        Qkinv: [124.097194, 852.430330017, 448.704299478, 1128.19639192, 1230.02908934, 11316.9459369]
        Qzinv: [0.0, 100.0, 100.0, 33271.2755284, 20032.1558168, 0.0]

        # threshold
        min_matched_ratio: 0.0

        visualize: true

      mapping:
        type: lidar.odometry_map_maintenance_v2

        map_voxel_size: 0.3

        crop_range_front: 60.0
        back_over_front_ratio: 1.0

        point_life_time: 10.0

        visualize: true

      vertex_test:
        type: lidar.vertex_test

        max_translation: 1.0
        max_rotation: 10.0

      memory:
        type: "live_mem_manager"

        window_size: 5 # unload data older than this many keyframes

    localization:
      recall:
        type: lidar.localization_map_recall

        map_version: "pointmap"

        visualize: true

      icp:
        type: lidar.localization_icp

        use_pose_prior: true

        # ICP parameters
        num_threads: 10
        first_num_steps: 3
        initial_max_iter: 6
        initial_max_pairing_dist: 5.0
        initial_max_planar_dist: 1.0
        refined_max_iter: 30
        refined_max_pairing_dist: 1.0
        refined_max_planar_dist: 0.3
        averaging_num_steps: 3

        # steam parameters
        verbose: false
        max_iterations: 1

        # threshold
        min_matched_ratio: 0.3

      memory:
        type: "graph_mem_manager"

        vertex_life_span: 5
        window_size: 3